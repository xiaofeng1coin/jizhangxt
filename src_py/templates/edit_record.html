{% extends 'layout.html' %}
{% block title %}编辑记录 - 阳光记账{% endblock %}
{% block head_css %}<link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">{% endblock %}

{% block content %}
<div class="edit-form-container">
    <div class="card add-record-card">
        <h3>编辑记录</h3>
        <form action="{{ url_for('edit_record', record_id=record.id) }}" method="post" id="edit-record-form">
            <div class="form-group type-selector">
                <input type="radio" id="type_expense" name="type" value="expense" {% if record.type == 'expense' %}checked{% endif %}>
                <label for="type_expense">支出</label>
                <input type="radio" id="type_income" name="type" value="income" {% if record.type == 'income' %}checked{% endif %}>
                <label for="type_income">收入</label>
            </div>
            <div class="form-group">
                <input type="number" step="0.01" name="amount" value="{{ record.amount }}" required>
            </div>
            <div class="form-group">
                <input type="text" id="category-input" name="category" value="{{ record.category }}" required list="expense-categories-list" autocomplete="off">
                 <datalist id="expense-categories-list">
                    {% for cat in expense_categories %}<option value="{{ cat }}">{% endfor %}
                </datalist>
                <datalist id="income-categories-list">
                    {% for cat in income_categories %}<option value="{{ cat }}">{% endfor %}
                </datalist>
            </div>
            <div class="form-group">
                <input type="date" id="date" name="date" value="{{ record.date }}">
            </div>
            <div class="form-group">
                <input type="text" name="description" value="{{ record.description }}" placeholder="写点备注... (可选)">
            </div>
            <button type="submit" class="btn-submit">保存更改</button>
            <a href="{{ request.referrer or url_for('records') }}" class="btn-cancel">取消</a>
        </form>
    </div>
</div>
<script>
// Logic to switch category datalist based on type
document.addEventListener('DOMContentLoaded', function() {
    const typeExpenseRadio = document.getElementById('type_expense');
    const typeIncomeRadio = document.getElementById('type_income');
    const categoryInput = document.getElementById('category-input');

    function updateCategoryDatalist() {
        if (typeExpenseRadio.checked) {
            categoryInput.setAttribute('list', 'expense-categories-list');
        } else {
            categoryInput.setAttribute('list', 'income-categories-list');
        }
    }
    typeExpenseRadio.addEventListener('change', updateCategoryDatalist);
    typeIncomeRadio.addEventListener('change', updateCategoryDatalist);
    updateCategoryDatalist(); // Initial check
});
</script>
{% endblock %}
