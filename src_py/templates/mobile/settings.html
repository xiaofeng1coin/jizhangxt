{# 文件: templates/mobile/settings.html (样式重构版) #}

{% extends 'mobile/layout.html' %}
{% block title %}系统设置{% endblock %}
{% block page_title %}系统设置{% endblock %}

{% block content %}
<!-- 月度预算 -->
<div class="content-card">
    <div class="card-header">
        <h3>月度预算</h3>
        <span class="card-header-subtitle">为支出类别设定预算</span>
    </div>
    <form action="{{ url_for('settings') }}" method="post" class="settings-form">
        <ul class="setting-list">
            {% if categories.expense %}
                {% for cat in categories.expense %}
                <li class="setting-item">
                    <label for="budget_{{ cat }}">{{ cat }}</label>
                    <div class="input-with-prefix">
                        <span>¥</span>
                        <input type="number" step="0.01" min="0" name="budget_{{ cat }}" value="{{ budgets[cat]|default('', true) }}" placeholder="未设置">
                    </div>
                </li>
                {% endfor %}
            {% else %}
                <li class="placeholder-text-small">请先添加支出类别</li>
            {% endif %}
        </ul>
        {% if categories.expense %}
            <button type="submit" class="btn-submit">保存预算</button>
        {% endif %}
    </form>
</div>

<!-- 【布局修正】类别管理现在是单列堆叠，更适合移动端 -->
<div class="content-card">
    <div class="card-header">
        <h3>类别管理</h3>
    </div>
    
    <!-- 支出类别 -->
    <div class="category-section">
        <h4 class="category-subtitle">支出类别</h4>
        <ul class="setting-list">
            {% for cat in categories.expense %}
            <li class="setting-item">
                <span>{{ cat }}</span>
                <form class="delete-form" action="{{ url_for('delete_category') }}" method="post" data-message="确定删除支出类别 '{{ cat }}' 吗？">
                    <input type="hidden" name="type" value="expense">
                    <input type="hidden" name="category" value="{{ cat }}">
                    <button type="submit" class="btn-delete" aria-label="删除">&times;</button>
                </form>
            </li>
            {% endfor %}
        </ul>
        <form action="{{ url_for('add_category') }}" method="post" class="add-category-form">
            <input type="hidden" name="type" value="expense">
            <input type="text" name="new_category" placeholder="新增支出类别" required>
            <button type="submit" aria-label="添加">+</button>
        </form>
    </div>

    <!-- 收入类别 -->
    <div class="category-section">
        <h4 class="category-subtitle">收入类别</h4>
        <ul class="setting-list">
            {% for cat in categories.income %}
            <li class="setting-item">
                <span>{{ cat }}</span>
                <form class="delete-form" action="{{ url_for('delete_category') }}" method="post" data-message="确定删除收入类别 '{{ cat }}' 吗？">
                    <input type="hidden" name="type" value="income">
                    <input type="hidden" name="category" value="{{ cat }}">
                    <button type="submit" class="btn-delete" aria-label="删除">&times;</button>
                </form>
            </li>
            {% endfor %}
        </ul>
        <form action="{{ url_for('add_category') }}" method="post" class="add-category-form">
            <input type="hidden" name="type" value="income">
            <input type="text" name="new_category" placeholder="新增收入类别" required>
            <button type="submit" aria-label="添加">+</button>
        </form>
    </div>
</div>

<!-- 【更新】数据管理 (导入/导出) -->
<div class="content-card">
    <div class="card-header">
        <h3>数据管理</h3>
        <span class="card-header-subtitle">备份与恢复</span>
    </div>
    
    <a href="{{ url_for('export_json') }}" class="export-link">
        <span>导出全部数据 (JSON)</span>
        <span>&rarr;</span>
    </a>
    <a href="{{ url_for('export_csv') }}" class="export-link" style="border-bottom: 1px solid var(--border-color); padding-bottom: 1rem; margin-bottom: 1rem;">
        <span>导出账单明细 (CSV)</span>
        <span>&rarr;</span>
    </a>
 
    <form action="{{ url_for('import_json') }}" method="post" enctype="multipart/form-data" class="modern-form" style="padding: 0;">
        <div class="form-group" style="margin-bottom: 0.5rem;">
            <label for="json_file">从备份文件导入</label>
            <input type="file" id="json_file" name="json_file" accept=".json" required>
        </div>
        <p style="font-size: 0.8em; color: var(--red); margin: 0.5rem 0 1rem; text-align: center; font-weight: 500;">
           警告：导入会覆盖所有现有数据！
        </p>
        <button type="submit" class="btn-submit" style="background-color: var(--red);">确认导入</button>
    </form>
</div>
{% endblock %}