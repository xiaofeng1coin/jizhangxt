{% extends 'mobile/layout.html' %}
{% block title %}ä»ªè¡¨ç›˜{% endblock %}
{% block page_title %}ä»ªè¡¨ç›˜{% endblock %}

{% block content %}
<!-- ä¸»è¦æ•°æ®æ˜¾ç¤ºåŒºåŸŸ (UI/UX å…¨é¢å‡çº§) -->
<div class="header-block">

    <!-- ã€æ ¸å¿ƒæ”¹é€ ã€‘å°†æœˆä»½é€‰æ‹©å™¨ä¸æ ‡é¢˜èä¸ºä¸€ä½“ -->
    <div class="month-selector-wrapper">
        <form id="month-selector-form" method="get" action="{{ url_for('index') }}">
            <!-- è¿™ä¸ª label æ˜¯ç”¨æˆ·çœ‹åˆ°å’Œç‚¹å‡»çš„â€œæŒ‰é’®â€ -->
            <label for="month-picker" class="month-display">
                <span>{{ selected_month }}</span>
                <!-- ä¸‹æ‹‰ç®­å¤´å›¾æ ‡ -->
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                    <path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/>
                </svg>
            </label>
            <!-- çœŸæ­£çš„ input æ§ä»¶è¢«éšè—ï¼Œä½†åŠŸèƒ½æ­£å¸¸ -->
            <input type="month" id="month-picker" name="selected_month" value="{{ selected_month }}" 
                   onchange="document.getElementById('month-selector-form').submit()"
                   style="position: absolute; opacity: 0; width: 0; height: 0;">
        </form>
    </div>

    <!-- å‡€ç»“ä½™é‡‘é¢ -->
    <p class="amount-hero">Â¥{{ '%.2f'|format(monthly_savings) }}</p>
    
    <!-- æ”¶å…¥ä¸æ”¯å‡º -->
    <div class="sub-stats">
        <div>
            <span class="label">æ€»æ”¶å…¥</span>
            <strong class="income">+ Â¥{{ '%.2f'|format(monthly_income_total) }}</strong>
        </div>
        <div>
            <span class="label">æ€»æ”¯å‡º</span>
            <strong class="expense">- Â¥{{ '%.2f'|format(monthly_expense_total) }}</strong>
        </div>
    </div>
</div>

<!-- æ“ä½œåŒºåŸŸä¿æŒä¸å˜ -->
<div class="actions-grid">
    <a href="{{ url_for('add_form') }}" class="action-card primary">
        <span class="icon">+</span>
        <span class="title">è®°ä¸€ç¬”</span>
        <span class="subtitle">è®°å½•ä½ çš„æ¯ä»½æ”¶æ”¯</span>
    </a>
    <a href="{{ url_for('records') }}" class="action-card">
        <span class="icon">ğŸ“‚</span>
        <span class="title">æŸ¥çœ‹æµæ°´</span>
        <span class="subtitle">å›é¡¾å†å²è´¦å•</span>
    </a>
</div>

<!-- é¢„ç®—æ¦‚è§ˆå¡ç‰‡ -->
<div class="content-card">
    <div class="card-header">
        <!-- ã€ä¼˜åŒ–ã€‘æ ‡é¢˜ä¹Ÿä½¿ç”¨åŠ¨æ€æœˆä»½ -->
        <h3>{{ selected_month }} é¢„ç®—æ¦‚è§ˆ</h3>
        <a href="{{ url_for('settings') }}">ç®¡ç†</a>
    </div>
    {% if total_budget > 0 %}
        <div class="budget-list">
            <div class="budget-item">
                <div class="progress-info">
                    <span>æ€»é¢„ç®—</span>
                    <span>{{ '%.0f'|format(overall_budget_progress) }}%</span>
                </div>
                <div class="progress-bar-container"><div class="progress-bar" style="width:{{ overall_budget_progress }}%;"></div></div>
            </div>
            {% for category, data in budget_progress.items() %}
            <div class="budget-item">
                <div class="progress-info">
                    <span>{{ category }}</span>
                    <span class="amount {% if data.overspent %}overspent{% endif %}">Â¥{{ '%.0f'|format(data.spent) }} / {{ '%.0f'|format(data.budget) }}</span>
                </div>
                <div class="progress-bar-container small"><div class="progress-bar {% if data.overspent %}overspent-bar{% endif %}" style="width:{{ data.progress }}%;"></div></div>
            </div>
            {% endfor %}
        </div>
    {% else %}
        <p class="placeholder-text">æš‚æœªè®¾ç½®é¢„ç®—ï¼Œ<a href="{{ url_for('settings') }}">ç«‹å³å‰å¾€è®¾ç½®</a>ã€‚</p>
    {% endif %}
</div>
{% endblock %}
