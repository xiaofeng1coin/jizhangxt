<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>{% block title %}阳光记账{% endblock %}</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/mobile.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    {% block head_extra %}{% endblock %}
</head>
<body>
    <header class="mobile-header">
        <h1>{% block page_title %}{% endblock %}</h1>
    </header>

    <main class="mobile-content">
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <div class="flash-messages-mobile">
                {% for category, message in messages %}
                    <div class="flash-mobile flash-{{ category }}">{{ message }}</div>
                {% endfor %}
                </div>
            {% endif %}
        {% endwith %}

        {% block content %}{% endblock %}
    </main>

    <!-- 记账表单浮层 -->
    <div class="add-record-overlay" id="add-record-overlay">
        <div class="add-record-form-container">
            <div class="add-record-header">
                <h3>记一笔</h3>
                <button id="close-add-form" class="close-btn">&times;</button>
            </div>
            <form action="{{ url_for('add_record') }}" method="post" id="add-record-form-mobile">
                <input type="hidden" name="type" id="record-type" value="expense">
                <div class="amount-input-wrapper">
                    <span class="currency-symbol">¥</span>
                    <input type="number" step="0.01" name="amount" placeholder="0.00" required>
                </div>
                <div class="type-category-selector">
                    <div class="type-tabs">
                        <button type="button" class="tab-btn active" data-type="expense">支出</button>
                        <button type="button" class="tab-btn" data-type="income">收入</button>
                    </div>
                    <div class="category-grid" id="expense-categories">
                        {% for cat in default_expense_categories %}<button type="button" class="category-btn" data-category="{{ cat }}">{{ cat }}</button>{% endfor %}
                    </div>
                    <div class="category-grid" id="income-categories" style="display: none;">
                        {% for cat in default_income_categories %}<button type="button" class="category-btn" data-category="{{ cat }}">{{ cat }}</button>{% endfor %}
                    </div>
                    <input type="hidden" name="category" id="selected-category" required>
                </div>
                <div class="form-row">
                    <input type="date" name="date" value="{{ today_for_form }}">
                    <input type="text" name="description" placeholder="备注(可选)">
                </div>
                <button type="submit" class="btn-submit-mobile">保存</button>
            </form>
        </div>
    </div>


    <nav class="bottom-nav">
        <a href="{{ url_for('index') }}" class="nav-item {% if request.endpoint == 'index' %}active{% endif %}">
            <span class="icon">📊</span><span class="label">概览</span>
        </a>
        <a href="{{ url_for('records') }}" class="nav-item {% if request.endpoint == 'records' %}active{% endif %}">
            <span class="icon">📋</span><span class="label">流水</span>
        </a>
        <button id="add-record-btn" class="nav-item add-btn">
            <span class="icon">+</span>
        </button>
        <a href="{{ url_for('annual_report') }}" class="nav-item {% if request.endpoint == 'annual_report' %}active{% endif %}">
            <span class="icon">📈</span><span class="label">报告</span>
        </a>
        <a href="{{ url_for('settings') }}" class="nav-item {% if request.endpoint == 'settings' %}active{% endif %}">
            <span class="icon">⚙️</span><span class="label">设置</span>
        </a>
    </nav>
    <script src="{{ url_for('static', filename='js/mobile.js') }}"></script>
</body>
</html>

